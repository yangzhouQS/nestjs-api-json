# APIJSONORM 项目概述

## 1. 项目简介

APIJSONORM 是腾讯开源的一个基于 JSON 的 ORM（对象关系映射）框架，它提供了一种创新的数据库操作方式。传统的 ORM 框架需要开发者编写 SQL 语句或使用复杂的 API，而 APIJSONORM 允许开发者通过 JSON 格式的请求直接与数据库交互，无需编写 SQL 语句。

### 1.1 核心特性

- **零 SQL 编写**：通过 JSON 请求直接操作数据库
- **自动 SQL 生成**：根据 JSON 请求自动生成对应的 SQL 语句
- **多数据库支持**：支持 MySQL、PostgreSQL、Oracle、SQL Server、MongoDB 等多种数据库
- **权限控制**：内置基于角色的访问控制（RBAC）
- **请求验证**：支持请求结构验证和内容验证
- **复杂查询支持**：支持 JOIN、子查询、聚合函数等复杂查询
- **远程函数调用**：支持远程调用自定义函数
- **事务管理**：内置事务支持
- **结果缓存**：支持 SQL 结果缓存

### 1.2 版本信息

- **当前版本**：8.1.0
- **开发语言**：Java
- **最低 Java 版本**：1.8
- **开源协议**：Apache License 2.0

## 2. 项目架构

### 2.1 整体架构

APIJSONORM 采用分层架构设计，主要分为以下几个层次：

```
┌─────────────────────────────────────────┐
│         客户端 JSON 请求               │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         Parser 层（解析层）             │
│  - AbstractParser                      │
│  - AbstractObjectParser                │
│  - AbstractFunctionParser              │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│      Verifier 层（验证层）              │
│  - AbstractVerifier                    │
│  - 权限验证                            │
│  - 内容验证                            │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│    SQLConfig 层（SQL 配置层）          │
│  - AbstractSQLConfig                   │
│  - SQL 生成                            │
│  - 数据库适配                          │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│   SQLExecutor 层（SQL 执行层）         │
│  - AbstractSQLExecutor                 │
│  - SQL 执行                            │
│  - 结果处理                            │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         数据库                          │
│  MySQL / PostgreSQL / Oracle / ...     │
└─────────────────────────────────────────┘
```

### 2.2 核心组件

#### 2.2.1 JSON 处理组件

- **JSON**：JSON 工具类，提供 JSON 序列化和反序列化功能
- **JSONRequest**：请求包装器，提供便捷的请求构建方法
- **JSONResponse**：响应解析器，提供响应数据的便捷访问方法

#### 2.2.2 Parser 组件

- **AbstractParser**：核心解析器，负责解析 JSON 请求并协调其他组件
- **AbstractObjectParser**：对象解析器，负责解析对象类型的请求
- **AbstractFunctionParser**：函数解析器，负责解析和执行远程函数调用

#### 2.2.3 SQLConfig 组件

- **AbstractSQLConfig**：SQL 配置生成器，负责根据 JSON 请求生成 SQL 语句
- **Join**：JOIN 配置类，支持多种 JOIN 类型
- **Subquery**：子查询配置类

#### 2.2.4 SQLExecutor 组件

- **AbstractSQLExecutor**：SQL 执行器，负责执行 SQL 并处理结果

#### 2.2.5 Verifier 组件

- **AbstractVerifier**：验证器，负责权限验证和内容验证

#### 2.2.6 Model 组件

- **Table**：表模型
- **Column**：列模型
- **Request**：请求模型
- **Document**：文档模型

## 3. 核心功能模块

### 3.1 请求解析模块

请求解析模块负责解析客户端发送的 JSON 请求，将其转换为内部可处理的数据结构。

**主要功能**：
- JSON 请求解析
- 请求结构验证
- 请求参数提取
- 路径解析

**核心类**：
- `AbstractParser`：核心解析器
- `AbstractObjectParser`：对象解析器
- `AbstractFunctionParser`：函数解析器

### 3.2 SQL 生成模块

SQL 生成模块负责根据解析后的 JSON 请求生成对应的 SQL 语句。

**主要功能**：
- SELECT 语句生成
- INSERT 语句生成
- UPDATE 语句生成
- DELETE 语句生成
- JOIN 语句生成
- WHERE 条件生成
- GROUP BY / HAVING 生成
- ORDER BY 生成
- 多数据库适配

**核心类**：
- `AbstractSQLConfig`：SQL 配置生成器
- `Join`：JOIN 配置类
- `Subquery`：子查询配置类

### 3.3 SQL 执行模块

SQL 执行模块负责执行生成的 SQL 语句并处理执行结果。

**主要功能**：
- SQL 执行
- 结果集处理
- 类型转换
- 缓存管理
- 事务管理

**核心类**：
- `AbstractSQLExecutor`：SQL 执行器

### 3.4 权限验证模块

权限验证模块负责验证请求的权限和内容。

**主要功能**：
- 登录验证
- 角色验证
- 操作权限验证
- 内容结构验证
- 数据权限验证

**核心类**：
- `AbstractVerifier`：验证器

### 3.5 函数调用模块

函数调用模块负责解析和执行远程函数调用。

**主要功能**：
- 函数解析
- 参数提取
- 函数调用
- 脚本执行（JavaScript、Lua 等）

**核心类**：
- `AbstractFunctionParser`：函数解析器

## 4. 请求方法

APIJSONORM 支持以下请求方法：

| 方法 | 说明 | 示例 |
|------|------|------|
| GET | 查询单个对象 | `{"User": {"id": 1}}` |
| GETS | 查询多个对象 | `{"User[]": {"count": 10}}` |
| HEAD | 查询总数 | `{"User": {"@head": "count(*)"}}` |
| HEADS | 查询多个总数 | - |
| POST | 新增数据 | `{"User": {"name": "张三"}}` |
| PUT | 更新数据 | `{"User": {"id": 1, "name": "李四"}}` |
| DELETE | 删除数据 | `{"User": {"id": 1}}` |
| CRUD | 混合操作 | - |

## 5. 数据库支持

APIJSONORM 支持以下数据库：

- MySQL
- PostgreSQL
- Oracle
- SQL Server
- MongoDB
- ClickHouse
- TiDB
- 其他支持 JDBC 的数据库

## 6. 使用场景

APIJSONORM 适用于以下场景：

1. **快速开发**：无需编写 SQL，通过 JSON 直接操作数据库
2. **API 开发**：快速构建 RESTful API
3. **移动应用后端**：为移动应用提供数据接口
4. **数据查询工具**：构建灵活的数据查询系统
5. **低代码平台**：作为低代码平台的数据访问层

## 7. 项目优势

1. **开发效率高**：无需编写 SQL，开发效率大幅提升
2. **学习成本低**：JSON 格式简单易懂，学习成本低
3. **安全性好**：内置权限控制和请求验证，安全性有保障
4. **灵活性强**：支持复杂查询和多种数据库
5. **可扩展性好**：支持自定义函数和脚本执行
6. **性能优秀**：内置缓存机制，性能优秀

## 8. 项目依赖

APIJSONORM 核心库不依赖任何第三方库，可以独立使用。如果需要使用 JSON 序列化功能，需要集成 JSON 库（如 Fastjson、Gson 等）。

## 9. 许可证

APIJSONORM 使用 Apache License 2.0 开源协议。

## 10. 相关链接

- GitHub: https://github.com/Tencent/APIJSON
- 官方文档: https://github.com/Tencent/APIJSON/blob/master/Document.md
- 在线测试: http://apijson.cn/unit
