# 语法 & 示例

## [#](http://apijson.cn/doc/zh/grammar.html#登录)登录

如果需要更多测试用例，请按照以下步骤获取： 1、在浏览器中输入 apijson.cn； 2、点击右上角的“登录”按钮登录； 3、点击“测试账号”按钮左边第二个按钮。（也就是“-”左边的第一个）获取各种测试用例 4、欢迎大家踊跃共享自己的测试用例； 5、也欢迎大家踊跃充值，哈哈哈哈~~~~~

## [#](http://apijson.cn/doc/zh/grammar.html#查询)查询

为了方便测试，我这里使用的 Chrome 浏览器的 Restlet Client 插件，大家可以根据自己的喜好使用不同的工具测试。

请注意 APIJSONApplication.java 中使用 Tomcat 默认的 8080 端口，如果不小心开着 PC 端的“微信”，8080 端口会被占用，建议改成 8081, 9090 等其它应用程序未占用的端口。

随便找一个上一节中导入的表，比如 Moment 表，我们取其中 ID 为 12 的一条出来看看。下图为数据库中的数据: ![test2](./asset/test2.2a94968c-1767265803495-1.png)

下图所示的连接地址：

```html
http://apijson.cn:8080/get
```

仅仅是用于演示。如果本地数据库已经配置完成，请在箭头所指方向输入本地数据库的链接地址。例如：

```html
http://localhost:端口号/get
```

![test1](./asset/test1.5825c982-1767265803495-3.png)

我们接着输入请求的 JSON：

```json
{
  "Moment": {
    "id": 12
  }
}
```

响应的 JSON：

```json
{
  "Moment": {
    "content": "1111534034",
    "date": "2017-02-08 16:06:11.0",
    "id": 12,
    "pictureList": [
      "http://static.oschina.net/uploads/img/201604/22172508_eGDi.jpg",
      "http://static.oschina.net/uploads/img/201604/22172507_rrZ5.jpg"
    ],
    "praiseUserIdList": [70793, 93793, 82001],
    "userId": 70793
  },
  "code": 200,
  "msg": "success"
}
```

## [#](http://apijson.cn/doc/zh/grammar.html#字段过滤)字段过滤

这里这么多字段，如果我只想要这个 content 字段的信息怎么办？

你可以这样请求：

```json
{
  "Moment": {
    "id": 12,
    "@column": "content"
  }
}
```

响应：

```json
{
  "Moment": {
    "content": "1111534034"
  },
  "code": 200,
  "msg": "success"
}
```

**@column 表示你要筛选出的字段**，如果是多个字段可以这样写"@column":"id,date,content"

## [#](http://apijson.cn/doc/zh/grammar.html#字段别名)字段别名

如果想要使用字段的别名应该这样写：**"@column":"id,date:time,content:text"**

响应：

```json
{
  "Moment": {
    "text": "1111534034",
    "time": "2017-02-08 16:06:11.0",
    "id": 12
  }
}
```

这样在返回的数据中 date 字段就变成了 time，content 字段变成了 text。

## [#](http://apijson.cn/doc/zh/grammar.html#逻辑运算-筛选)逻辑运算-筛选

如果想要筛选出，ID 在`12,15,32`中的这三条数据的`日期`和`内容`怎么办呢？

请求：

```json
{
  "[]": {
    "Moment": {
      "id{}": [12, 15, 32],
      "@column": "id,date,content"
    }
  }
}
```

响应：

```json
{
  "[]": [
    {
      "Moment": {
        "content": "1111534034",
        "date": "2017-02-08 16:06:11.0",
        "id": 12
      }
    },
    {
      "Moment": {
        "content": "APIJSON is a JSON Transmission Structure Protocol…",
        "date": "2017-02-08 16:06:11.0",
        "id": 15
      }
    },
    {
      "Moment": {
        "date": "2017-02-08 16:06:11.0",
        "id": 32
      }
    }
  ],
  "code": 200,
  "msg": "success"
}
```

如果所要筛选的数据的是在一定范围内的，比如 ID 是 300 到 400 之间的

你可以这样过滤`"id&{}":">=300,<=400"`

&的作用是表明后面的两个过滤条件的逻辑关系

```sql
(ID >= 300 AND ID <= 500)
```

现在的逻辑符号一共有三种，`&`，`|`，`!`

默认的逻辑关系是`|`，也就是说`"id|{}":"<=300,>=400"`和`"id{}":"<=300,>=400"`等价。

`!`主要用于反选，黑名单之类的

`"id!{}":[12,15,32]`表示`id`不在 12，15，32 内的其他数据。

复杂一些，如果多个条件相互组合，可以写多个关于 id 的过滤条件

```json
{
  "[]": {
    "Moment": {
      "id&{}": ">=10,<=40",
      "id!{}": [12],
      "@column": "id,date,content:text"
    }
  }
}
```

比如这里表示 id 在 10 到 40 之间，但是却不包含 12 的数据。

## [#](http://apijson.cn/doc/zh/grammar.html#模糊查询)模糊查询

```json
{
  "[]": {
    "Moment": {
      "content$": "%APIJSON%",
      "@column": "id,date,content:text"
    }
  }
}
```

使用方式有多种：

`keyword%`，以`keyword`开头的字符串。

`%keyword`，以`keyword`结束的字符串。

`%keyword%`，包含`keyword`的字符串，如：`keyword123`、`123keyword`、`123keyword123`

`%k%e%y%`，包含字母`k`,`e`,`y`的字符串

还有几种比较便捷的方式，我们这里如果使用`"content~":"keyword"`来代替`"content$":"%keyword%"`，同样可以表示包含某字符串。

## [#](http://apijson.cn/doc/zh/grammar.html#正则匹配)正则匹配

```json
{
  "[]": {
    "Moment": {
      "content?": "^[0-9]+$",
      "@column": "id,date,content:text"
    }
  }
}
```

正则表达式`^[0-9]+$`，查询`content`为纯数字的数据，[MySQL 的正则语法 (opens new window)](http://www.runoob.com/mysql/mysql-regexp.html)如下：

| 模式       | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| ^          | 匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 '\n' 或 '\r' 之后的位置。 |
| $          | 匹配输入字符串的结束位置。如果设置了 RegExp 对象的 Multiline 属性，$ 也匹配 '\n' 或 '\r' 之前的位置。 |
| .          | 匹配除 "\n" 之外的任何单个字符。要匹配包括 '\n' 在内的任何字符，请使用象 '[.\n]' 的模式。 |
| [...]      | 字符集合。匹配所包含的任意一个字符。例如， '[abc]' 可以匹配 "plain" 中的 'a'。 |
| [^...]     | 负值字符集合。匹配未包含的任意字符。例如， '[^abc]' 可以匹配 "plain" 中的'p'。 |
| p1\|p2\|p3 | 匹配 p1 或 p2 或 p3。例如，'z\|food' 能匹配 "z" 或 "food"。'(z\|f)ood' 则匹配 "zood" 或 "food"。 |
| *          | 匹配前面的子表达式零次或多次。例如，zo* 能匹配 "z" 以及 "zoo"。* 等价于{0,}。 |
| +          | 匹配前面的子表达式一次或多次。例如，'zo+' 能匹配 "zo" 以及 "zoo"，但不能匹配 "z"。+ 等价于 {1,}。 |
| {n}        | n 是一个非负整数。匹配确定的 n 次。例如，'o{2}' 不能匹配 "Bob" 中的 'o'，但是能匹配 "food" 中的两个 o。 |
| {n,m}      | m 和 n 均为非负整数，其中 n <= m。最少匹配 n 次且最多匹配 m 次。 |

## [#](http://apijson.cn/doc/zh/grammar.html#列表数据)列表数据

之前我们看到返回的数据是这样的

```json
{
  "Moment": {
    "content": "1111534034",
    "date": "2017-02-08 16:06:11.0",
    "id": 12,
    "pictureList": [
      "http://static.oschina.net/uploads/img/201604/22172508_eGDi.jpg",
      "http://static.oschina.net/uploads/img/201604/22172507_rrZ5.jpg"
    ],
    "praiseUserIdList": [70793, 93793, 82001],
    "userId": 70793
  },
  "code": 200,
  "msg": "success"
}
```

里面的`pictureList`和`praiseUserIdList`是数组，这种数据在 Mysql 数据库中是 JSON 数据格式的。

![1542357146401](./asset/1542357146401.355e8aff-1767265803495-5.png)

数据库里存储的值是这样的

![1542357265371](./asset/1542357265371.4bc1b7f8-1767265803495-7.png)

如果我们想过滤出里面有`82001`的数据，我们应该这样请求

```json
{
  "[]": {
    "Moment": {
      "praiseUserIdList<>": 82001,
      "@column": "id,date,content,praiseUserIdList"
    }
  }
}
```

结果是类似这样的，为了显示方便剔除了一些数据。

```json
{
  "[]": [
    {
      "Moment": {
        "date": "2017-02-08 16:06:11.0",
        "id": 32,
        "praiseUserIdList": [38710, 82002, 82001]
      }
    },
    {
      "Moment": {
        "content": "This is a Content...-435",
        "date": "2017-02-01 19:14:31.0",
        "id": 58,
        "praiseUserIdList": [38710, 82003, 82001]
      }
    },
    {
      "Moment": {
        "content": "https://gss2.bdstatic.com/-fo3dSag_xIb.jpg",
        "date": "2018-10-27 17:58:02.0",
        "id": 1540634282433,
        "praiseUserIdList": [82001]
      }
    }
  ],
  "code": 200,
  "msg": "success"
}
```

## [#](http://apijson.cn/doc/zh/grammar.html#分页)分页

对于数量太多的数据，我们很多时候都需要分页操作，这时候我们可以用类似下面这样的请求

```json
{
  "[]": {
    "Moment": {
      "@column": "id,date,content,praiseUserIdList"
    },
    "page": 0,
    "count": 5
  }
}
```

请注意，这里的`page`和`count`是放在`[]`内的属性，而不是`Moment`对象里。这里`count`表示每页的数量，`page`表示第几页，页数从 0 开始算。

也许你想看看这个请求对应的 SQL 语句

```sql
SELECT `id`,`date`,`content`,`praiseUserIdList` FROM `thea`.`Moment` LIMIT 5 OFFSET 0
```

这里`thea`是我自己的`schema`的名字，你的可能会有所不同。

如果不想分页的，也提供了一套特殊的查询方式。这种查询方式有三种，请求方式类型这样

```json
{
  "[]": {
    "Moment": {
      "@column": "id,date,content,praiseUserIdList"
    },
    "query": 2
  },
  "total@": "/[]/total"
}
```

这里因为`query`的值是 2，所有会查询`Moment`表中所有的数据。如果是 1 的话，则会返回当前表的总数

```json
{ "total": 59, "code": 200, "msg": "success" }
```

数据库中的数量：

![1544515879364](data:image/png;base64,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)

当然，如果你添加了过滤条件，返回的数量就会是你所过滤的数量，比如：

```json
{
  "[]": {
    "Moment": {
      "@column": "id,date,content,praiseUserIdList",
      "praiseUserIdList<>": 38710
    },
    "query": 1
  },
  "total@": "/[]/total"
}
```

返回：

```json
{ "total": 12, "code": 200, "msg": "success" }
```

## [#](http://apijson.cn/doc/zh/grammar.html#排序)排序

要使用排序的话，这样操作

```json
{
  "[]": {
    "Moment": {
      "@column": "id,date,content,praiseUserIdList",
      "praiseUserIdList<>": 38710,
      "@order": "date-,id,content+"
    }
  }
}
```

`"@order":"date-,id,content+"`其中，字段的前后顺序表示字段排序的优先级。`id`和`id+`是等价的，默认就是升序排列。`date-`表示将`date`字段降序排列。

## [#](http://apijson.cn/doc/zh/grammar.html#关联查询)关联查询

在讲解关联查询的时候，我们需要先了解下表之间的关系

现在有两张表 USER 和 MOMENT，两张表的关系是下面这样

![1545468294295](data:image/png;base64,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)

MOMENT 表示评论，每一条评论会有一个发表评论的用户 USER，所以 MOMENT 表里会有一个 USER 表的外键关联

对于这样的数据关系，我们在查询评论时，很多时候我们会连带着用户一起查处来，这样又如何操作呢

```json
{
  "[]": {
    "Moment": {
      "@column": "id,date,userId",
      "id": 12
    },
    "User": {
      "id@": "/Moment/userId",
      "@column": "id,name"
    }
  }
}
```

这个请求稍微复杂点，首先我们用`[]`对象表示我们是想查询出一个列表，这个列表包含两个部分`Moment`和`User`。

其中`Moment`是我们想要查询的主要内容，它的写法也和一般查询数据时无异。

`User`是与`Moment`相关联的数据，所以查询的时候我们需要用`id@`来表示他们之间的关联关系

`/Moment/userId`中，最开始的`/`相当于是指明了`[]`的位置，`/Moment`表示`[]`对象下的`Moemnt`对象，`/Moment/userId`表示`Moemnt`的`userId`字段是与`User`的`id`关联的。

响应的数据：

```json
{
  "[]": [
    {
      "Moment": {
        "date": "2017-02-08 16:06:11.0",
        "id": 12,
        "userId": 70793
      },
      "User": {
        "id": 70793,
        "name": "Strong"
      }
    }
  ],
  "code": 200,
  "msg": "success"
}
```

## [#](http://apijson.cn/doc/zh/grammar.html#分组查询)分组查询

在了解分组查询之前，我们需要先了解下 APIJSON 所支持的函数

| 函数名 | 说明                       |
| ------ | -------------------------- |
| count  | 统计分组下，某字段的个数   |
| sum    | 统计分组下，某字段的和     |
| max    | 统计分组下，某字段的最大值 |
| min    | 统计分组下，某字段的最小值 |
| avg    | 统计分组下，某字段的平均值 |

比如，如果只是单纯的查出最大值，这样请求就可以了

```json
{
  "[]": {
    "Moment": {
      "@column": "max(id):maxid"
    }
  }
}
```

响应：

```json
{
  "[]": [
    {
      "Moment": {
        "maxid": 1541912160047
      }
    }
  ],
  "code": 200,
  "msg": "success"
}
```

这里`maxid`是我们取的别名

如果是有分组条件的，那我们需要使用`@group`

比如，像下面 SALE 表，这张表表示，2018 年 1 月 1 日某公司门下的 3 个店铺（STORE_ID）的营业额（AMT）数据

| ID   | STORE_ID | AMT  |
| ---- | -------- | ---- |
| 1    | 1        | 100  |
| 2    | 1        | 80   |
| 3    | 2        | 30   |
| 4    | 2        | 100  |
| 5    | 3        | 210  |

如果，我们想要计算出这天每个店铺一共卖了多少，我们通过 APIJSON 可以这样查询

```text
{
  "[]": {
      "Sale":{
        "@column":"store_id;sum(amt):totAmt",
        "@group":"store_id"
      }
  }
}
```

### [#](http://apijson.cn/doc/zh/grammar.html#登录-2)登录

如果没有登录，由于权限的限制，是需要登录的。

登录地址`http://127.0.0.1:8080/login`，发送请求

```json
{
  "phone": "13000038710",
  "password": "apijson"
}
```

账号和密码，可以到`apijson_user`里面查询

### [#](http://apijson.cn/doc/zh/grammar.html#测试新增)测试新增

接口地址：`http://localhost:8080/post`

我们想新增一条备注时，发送这样的请求

请求

```json
{
  "Moment": {
    "content": "今天天气不错，到处都是提拉米苏雪",
    "userId": 38710
  },
  "tag": "Moment"
}
```

`tag`是我们在`request`表里面配置的`tag`字段。

响应

```json
{
  "Moment": {
    "code": 200,
    "count": 1,
    "id": 1544520921923,
    "msg": "success"
  },
  "code": 200,
  "msg": "success"
}
```

返回的`id`是新增的数据的新 id

### [#](http://apijson.cn/doc/zh/grammar.html#测试修改)测试修改

接口地址：`http://localhost:8080/put`

修改备注和新增类似

请求

```json
{
  "Moment": {
    "id": 1544520921923,
    "content": "海洋动物数量减少，如果非吃不可，不点杀也是在保护它们"
  },
  "tag": "Moment"
}
```

响应

```json
{
  "Moment": {
    "code": 200,
    "count": 1,
    "id": 1544520921923,
    "msg": "success"
  },
  "code": 200,
  "msg": "success"
}
```

如果要对`json`类型操作的话，这样请求

```json
{
  "Moment": {
    "id": 1544520921923,
    "praiseUserIdList+": [123]
  },
  "tag": "Moment"
}
```

这里的`praiseUserIdList`是一个`json`类型的字段，在操作之前它是空的`[]`，提交以后它是`[123]`，如果再添加一个 21，则会变成`[123,21]`

要删除其中的值，把`+`变成`-`即可

### [#](http://apijson.cn/doc/zh/grammar.html#测试删除)测试删除

接口地址：`http://localhost:8080/delete`

请求

```json
{
  "Moment": {
    "id": 1544520921923
  },
  "tag": "Moment"
}
```
