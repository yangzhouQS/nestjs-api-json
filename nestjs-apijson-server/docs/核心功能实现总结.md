# APIJSON ORM æ ¸å¿ƒåŠŸèƒ½å®ç°æ€»ç»“

## å®ç°æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº† APIJSON ORM æ ¸å¿ƒåŠŸèƒ½çš„å®ç°æƒ…å†µï¼ŒåŒ…æ‹¬å·²å®Œæˆçš„åŠŸèƒ½å’Œå¾…å®ç°çš„åŠŸèƒ½ã€‚

## å·²å®ŒæˆåŠŸèƒ½ âœ…

### 1. ç‰¹æ®Šå­—æ®µè§£æå™¨

#### 1.1 @column åˆ—é€‰æ‹©è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/column-parser.ts`](../src/core/parsers/column-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒå­—æ®µé€‰æ‹©ï¼ˆå¦‚ï¼š`"@column":"id,name,age"`ï¼‰
- æ”¯æŒå­—æ®µåˆ«åï¼ˆå¦‚ï¼š`"@column":"id,date:time,content:text"`ï¼‰
- æ”¯æŒå­—æ®µæ’é™¤ï¼ˆå¦‚ï¼š`"@column":"id,name,-password"`ï¼‰
- æ”¯æŒå¤šç§è¾“å…¥æ ¼å¼ï¼ˆå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(columnValue)` - è§£æ @column å­—æ®µ
- `toSelectClause(config, quote)` - ç”Ÿæˆ SELECT å­å¥
- `validate(config, availableColumns)` - éªŒè¯åˆ—é…ç½®

**ç¤ºä¾‹**:
```json
{
  "Moment": {
    "@column": "id,date:time,content:text"
  }
}
```

#### 1.2 @order æ’åºè§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/order-parser.ts`](../src/core/parsers/order-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒå¤šå­—æ®µæ’åº
- æ”¯æŒå‡åºï¼ˆé»˜è®¤ï¼‰å’Œé™åºï¼ˆå­—æ®µååŠ `-`ï¼‰
- æ”¯æŒä¼˜å…ˆçº§ï¼ˆæŒ‰å­—æ®µé¡ºåºï¼‰
- æ”¯æŒå¤šç§è¾“å…¥æ ¼å¼ï¼ˆå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(orderValue)` - è§£æ @order å­—æ®µ
- `toOrderByClause(config, quote)` - ç”Ÿæˆ ORDER BY å­å¥
- `validate(config, availableColumns)` - éªŒè¯æ’åºé…ç½®

**ç¤ºä¾‹**:
```json
{
  "[]": {
    "Moment": {
      "@order": "date-,id,content+"
    }
  }
}
```

#### 1.3 @group åˆ†ç»„è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/group-parser.ts`](../src/core/parsers/group-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒå¤šå­—æ®µåˆ†ç»„
- æ”¯æŒå­—ç¬¦ä¸²å’Œæ•°ç»„è¾“å…¥æ ¼å¼
- æ”¯æŒåˆ†ç»„éªŒè¯

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(groupValue)` - è§£æ @group å­—æ®µ
- `toGroupByClause(config, quote)` - ç”Ÿæˆ GROUP BY å­å¥
- `validate(config, availableColumns)` - éªŒè¯åˆ†ç»„é…ç½®

**ç¤ºä¾‹**:
```json
{
  "[]": {
    "Moment": {
      "@column": "userId;max(id)",
      "@group": "userId"
    }
  }
}
```

#### 1.4 @having åˆ†ç»„è¿‡æ»¤è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/having-parser.ts`](../src/core/parsers/having-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒèšåˆå‡½æ•°æ¡ä»¶è¿‡æ»¤
- æ”¯æŒå¤šä¸ªæ¡ä»¶ç»„åˆ
- ä¸ @group ä¸€èµ·ä½¿ç”¨

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(havingValue)` - è§£æ @having å­—æ®µ
- `toHavingClause(config, quote)` - ç”Ÿæˆ HAVING å­å¥
- `validate(config, availableColumns)` - éªŒè¯ HAVING é…ç½®

**ç¤ºä¾‹**:
```json
{
  "[]": {
    "Moment": {
      "@column": "userId;max(id):maxId",
      "@group": "userId",
      "@having": "maxId>=100"
    }
  }
}
```

#### 1.5 @combine ç»„åˆæ¡ä»¶è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/combine-parser.ts`](../src/core/parsers/combine-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒæ¡ä»¶ç»„åˆæ–¹å¼æŒ‡å®š
- æ”¯æŒé€»è¾‘è¿ç®—ç¬¦ï¼ˆ&, |, !ï¼‰
- æ”¯æŒå¤šç§ç»„åˆç±»å‹ï¼ˆAPPEND, REPLACE, MERGEï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(combineValue)` - è§£æ @combine å­—æ®µ
- `validate(config, availableTables)` - éªŒè¯ç»„åˆé…ç½®

**ç¤ºä¾‹**:
```json
{
  "User": {
    "name~":"a",
    "tag~":"a",
    "@combine":"name~,tag~"
  }
}
```

#### 1.6 æ•°ç»„å…³é”®è¯è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/pagination-parser.ts`](../src/core/parsers/pagination-parser.ts)

**åŠŸèƒ½**:
- `count`: æŸ¥è¯¢æ•°é‡ï¼ˆ0è¡¨ç¤ºæœ€å¤§å€¼ï¼Œé»˜è®¤100ï¼‰
- `page`: æŸ¥è¯¢é¡µç ï¼ˆä»0å¼€å§‹ï¼‰
- `query`: æŸ¥è¯¢å†…å®¹ï¼ˆ0-å¯¹è±¡ï¼Œ1-æ€»æ•°ï¼Œ2-æ•°æ®+æ€»æ•°+åˆ†é¡µï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(countValue, pageValue)` - è§£æåˆ†é¡µå‚æ•°
- `toLimitClause(config)` - ç”Ÿæˆ LIMIT å­å¥
- `validate(config)` - éªŒè¯åˆ†é¡µé…ç½®

**ç¤ºä¾‹**:
```json
{
  "[]": {
    "count": 5,
    "page": 3,
    "query": 2,
    "Moment": {}
  }
}
```

### 2. JOINæŸ¥è¯¢æ”¯æŒ

#### 2.1 JOINè§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/join-parser.ts`](../src/core/parsers/join-parser.ts)

**åŠŸèƒ½**:
- è§£æ JOIN è¯­æ³•
- æ”¯æŒ 10 ç§ JOIN ç±»å‹
- ç”Ÿæˆ JOIN SQL è¯­å¥
- åŒºåˆ† APP JOIN å’Œ SQL JOIN

**JOIN ç±»å‹**:
1. APP JOIN (@) - åº”ç”¨å±‚ JOIN
2. INNER JOIN (&) - å†…è¿æ¥
3. FULL JOIN (|) - å…¨è¿æ¥
4. LEFT JOIN (<) - å·¦è¿æ¥
5. RIGHT JOIN (>) - å³è¿æ¥
6. OUTER JOIN (!) - å¤–è¿æ¥
7. SIDE JOIN (^) - ä¾§è¿æ¥
8. ANTI JOIN (() - åè¿æ¥
9. FOREIGN JOIN ()) - å¤–éƒ¨è¿æ¥
10. ASOF JOIN (~) - ASOF è¿æ¥

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(joinValue)` - è§£æ join å­—æ®µ
- `toJoinClause(config, quote)` - ç”Ÿæˆ JOIN å­å¥
- `getAppJoins(config)` - è·å– APP JOIN é…ç½®
- `getSqlJoins(config)` - è·å– SQL JOIN é…ç½®

**ç¤ºä¾‹**:
```json
{
  "[]": {
    "join": "&/User/id@,</Comment/momentId@",
    "Moment": {},
    "User": {
      "id@": "/Moment/userId"
    },
    "Comment": {
      "momentId@": "/[]/Moment/id"
    }
  }
}
```

### 3. å­æŸ¥è¯¢åŠŸèƒ½

#### 3.1 å­æŸ¥è¯¢è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/subquery-parser.ts`](../src/core/parsers/subquery-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒ WHERE å­æŸ¥è¯¢
- æ”¯æŒ FROM å­æŸ¥è¯¢
- æ”¯æŒ SELECT å­æŸ¥è¯¢
- æ”¯æŒ EXISTS å­æŸ¥è¯¢
- æ”¯æŒ ALL/ANY èŒƒå›´

**å­æŸ¥è¯¢ç±»å‹**:
- WHERE å­æŸ¥è¯¢ï¼š`"id@":{"from":"Comment","Comment":{"@column":"min(userId)"}}`
- EXISTS å­æŸ¥è¯¢ï¼š`"id}{@":{"from":"Comment","Comment":{"momentId":15}}`
- ALL/ANY å­æŸ¥è¯¢ï¼š`"id>@":{"from":"Comment","Comment":{"@column":"min(userId)"}}`

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(key, value)` - è§£æå­æŸ¥è¯¢
- `toSQLSubquery(result, quote)` - ç”Ÿæˆå­æŸ¥è¯¢ SQL
- `generateWhereSubquery(result, quote)` - ç”Ÿæˆ WHERE å­æŸ¥è¯¢
- `generateExistsSubquery(result, quote)` - ç”Ÿæˆ EXISTS å­æŸ¥è¯¢

**ç¤ºä¾‹**:
```json
{
  "User": {
    "id@": {
      "from": "Comment",
      "Comment": {
        "@column": "min(userId)"
      }
    }
  }
}
```

### 4. å¼•ç”¨èµ‹å€¼åŠŸèƒ½

#### 4.1 å¼•ç”¨è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/reference-parser.ts`](../src/core/parsers/reference-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒ key@ å•å€¼å¼•ç”¨
- æ”¯æŒ key{}@ æ•°ç»„å¼•ç”¨
- æ”¯æŒè·¯å¾„è§£æ
- æ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„

**å¼•ç”¨ç±»å‹**:
- å•å€¼å¼•ç”¨ï¼š`"id@":"/Moment/userId"`
- æ•°ç»„å¼•ç”¨ï¼š`"id{}@":"/[]/Moment/id"`
- ç›¸å¯¹è·¯å¾„ï¼š`"/Moment/userId"`ï¼ˆä»çˆ¶å®¹å™¨å¼€å§‹ï¼‰
- ç»å¯¹è·¯å¾„ï¼š`"Moment/userId"`ï¼ˆä»æ ¹å¼€å§‹ï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(key, value)` - è§£æå¼•ç”¨
- `parsePath(path)` - è§£æè·¯å¾„
- `getValueByPath(path, context)` - æ ¹æ®è·¯å¾„è·å–å€¼
- `resolveReference(path, context, currentPath)` - è§£æå¼•ç”¨
- `resolveArrayReference(config, context, currentPath)` - è§£ææ•°ç»„å¼•ç”¨

**ç¤ºä¾‹**:
```json
{
  "Moment": {
    "userId": 38710
  },
  "User": {
    "id@": "/Moment/userId"
  }
}
```

### 5. æ•°ç»„æŸ¥è¯¢åŠŸèƒ½

#### 5.1 æ•°ç»„è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/array-parser.ts`](../src/core/parsers/array-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒ Table[] è¡¨æ•°ç»„æŸ¥è¯¢
- æ”¯æŒ [] æ•°ç»„å®¹å™¨æŸ¥è¯¢
- æ”¯æŒæ•°ç»„æå–
- æ”¯æŒ countã€pageã€query å‚æ•°

**æ•°ç»„ç±»å‹**:
- è¡¨æ•°ç»„ï¼š`"User[]":{"count":3,"User":{}}`
- æ•°ç»„å®¹å™¨ï¼š`"[]":{"count":3,"Moment":{}}`
- æå–æ•°ç»„ï¼š`"User-id[]":{"count":3,"User":{}}`

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(key, value)` - è§£ææ•°ç»„æŸ¥è¯¢
- `extractArray(result, config)` - æå–æ•°ç»„ç»“æœ
- `extractByKey(result, key)` - æ ¹æ®é”®æå–æ•°æ®
- `validate(config, availableTables)` - éªŒè¯æ•°ç»„æŸ¥è¯¢é…ç½®

**ç¤ºä¾‹**:
```json
{
  "User[]": {
    "count": 3,
    "User": {}
  }
}
```

### 6. èšåˆå‡½æ•°æ”¯æŒ

#### 6.1 èšåˆå‡½æ•°è§£æå™¨
**æ–‡ä»¶**: [`src/core/parsers/aggregate-parser.ts`](../src/core/parsers/aggregate-parser.ts)

**åŠŸèƒ½**:
- æ”¯æŒ COUNT, SUM, AVG, MIN, MAX
- æ”¯æŒèšåˆå‡½æ•°åˆ«å
- æ”¯æŒèšåˆå‡½æ•°æ¡ä»¶
- æ”¯æŒåˆ†å·åˆ†éš”å¤šä¸ªèšåˆå‡½æ•°

**èšåˆå‡½æ•°**:
- COUNT: `COUNT(*)` æˆ– `COUNT(id)`
- SUM: `SUM(amount)`
- AVG: `AVG(score)`
- MIN: `MIN(price)`
- MAX: `MAX(price)`

**æ ¸å¿ƒæ–¹æ³•**:
- `parse(expression)` - è§£æèšåˆå‡½æ•°
- `parseMultiple(expressions)` - è§£æå¤šä¸ªèšåˆå‡½æ•°
- `parseSemicolonSeparated(expression)` - è§£æåˆ†å·åˆ†éš”çš„èšåˆå‡½æ•°
- `toSQL(config, quote)` - ç”Ÿæˆèšåˆå‡½æ•° SQL
- `toSQLMultiple(configs, quote)` - ç”Ÿæˆå¤šä¸ªèšåˆå‡½æ•° SQL

**ç¤ºä¾‹**:
```json
{
  "[]": {
    "Moment": {
      "@column": "userId;count(id):count"
    }
  }
}
```

## å¾…å®ç°åŠŸèƒ½ ğŸ“‹

### 7. ç¼“å­˜æœºåˆ¶

#### 7.1 å†…å­˜ç¼“å­˜å®ç°
**æ–‡ä»¶**: å¾…åˆ›å»º `src/core/cache/memory-cache.ts`

**åŠŸèƒ½**:
- å†…å­˜ç¼“å­˜å­˜å‚¨
- ç¼“å­˜è¿‡æœŸç­–ç•¥
- ç¼“å­˜æ¸…ç†æœºåˆ¶

**æ ¸å¿ƒæ–¹æ³•**:
- `getCache(key)` - è·å–ç¼“å­˜
- `putCache(key, value, expireTime)` - è®¾ç½®ç¼“å­˜
- `removeCache(key)` - åˆ é™¤ç¼“å­˜
- `clearCache()` - æ¸…ç©ºç¼“å­˜

#### 7.2 Redisç¼“å­˜å®ç°
**æ–‡ä»¶**: å¾…åˆ›å»º `src/core/cache/redis-cache.ts`

**åŠŸèƒ½**:
- Redis ç¼“å­˜å­˜å‚¨
- åˆ†å¸ƒå¼ç¼“å­˜æ”¯æŒ
- ç¼“å­˜è¿‡æœŸç­–ç•¥

**æ ¸å¿ƒæ–¹æ³•**:
- `getCache(key)` - è·å–ç¼“å­˜
- `putCache(key, value, expireTime)` - è®¾ç½®ç¼“å­˜
- `removeCache(key)` - åˆ é™¤ç¼“å­˜
- `clearCache()` - æ¸…ç©ºç¼“å­˜

### 8. äº‹åŠ¡ç®¡ç†

#### 8.1 äº‹åŠ¡ç®¡ç†å™¨
**æ–‡ä»¶**: å¾…åˆ›å»º `src/core/transaction/transaction-manager.ts`

**åŠŸèƒ½**:
- äº‹åŠ¡å¼€å§‹
- äº‹åŠ¡æäº¤
- äº‹åŠ¡å›æ»š
- ä¿å­˜ç‚¹ç®¡ç†

**æ ¸å¿ƒæ–¹æ³•**:
- `begin()` - å¼€å§‹äº‹åŠ¡
- `commit()` - æäº¤äº‹åŠ¡
- `rollback()` - å›æ»šäº‹åŠ¡
- `setSavepoint(name)` - è®¾ç½®ä¿å­˜ç‚¹
- `rollbackToSavepoint(name)` - å›æ»šåˆ°ä¿å­˜ç‚¹

### 9. æ‰¹é‡æ“ä½œ

#### 9.1 æ‰¹é‡æ“ä½œå¤„ç†å™¨
**æ–‡ä»¶**: å¾…åˆ›å»º `src/core/batch/batch-processor.ts`

**åŠŸèƒ½**:
- æ‰¹é‡æ’å…¥
- æ‰¹é‡æ›´æ–°
- æ‰¹é‡åˆ é™¤

**æ ¸å¿ƒæ–¹æ³•**:
- `batchInsert(table, records)` - æ‰¹é‡æ’å…¥
- `batchUpdate(table, updates)` - æ‰¹é‡æ›´æ–°
- `batchDelete(table, ids)` - æ‰¹é‡åˆ é™¤

**ç¤ºä¾‹**:
```json
{
  "Comment[]": [
    {
      "momentId": 12,
      "content": "Comment 1"
    },
    {
      "momentId": 15,
      "content": "Comment 2"
    }
  ],
  "tag": "Comment:[]"
}
```

### 10. æƒé™æ§åˆ¶

#### 10.1 æƒé™éªŒè¯å™¨
**æ–‡ä»¶**: å¾…å®Œå–„ `src/core/abstract-verifier.ts`

**åŠŸèƒ½**:
- è§’è‰²éªŒè¯
- è®¿é—®æ§åˆ¶
- å†…å®¹éªŒè¯
- ç™»å½•éªŒè¯

**è§’è‰²ç±»å‹**:
- UNKNOWN: æœªçŸ¥ç”¨æˆ·
- LOGIN: å·²ç™»å½•ç”¨æˆ·
- CONTACT: è”ç³»äºº
- CIRCLE: åœˆå­
- OWNER: æ‰€æœ‰è€…
- ADMIN: ç®¡ç†å‘˜

**æ ¸å¿ƒæ–¹æ³•**:
- `verifyLogin()` - éªŒè¯ç™»å½•
- `verifyRole(role)` - éªŒè¯è§’è‰²
- `verifyAccess(table, method)` - éªŒè¯è®¿é—®æƒé™
- `verifyContent(table, content)` - éªŒè¯å†…å®¹

## æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®¢æˆ·ç«¯ JSON è¯·æ±‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Parser å±‚ï¼ˆè§£æå±‚ï¼‰           â”‚
â”‚  - ColumnParser                     â”‚
â”‚  - OrderParser                      â”‚
â”‚  - GroupParser                      â”‚
â”‚  - HavingParser                     â”‚
â”‚  - CombineParser                   â”‚
â”‚  - PaginationParser                 â”‚
â”‚  - JoinParser                      â”‚
â”‚  - SubqueryParser                  â”‚
â”‚  - ReferenceParser                  â”‚
â”‚  - ArrayParser                     â”‚
â”‚  - AggregateParser                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Verifier å±‚ï¼ˆéªŒè¯å±‚ï¼‰            â”‚
â”‚  - AbstractVerifier                 â”‚
â”‚  - æƒé™éªŒè¯                        â”‚
â”‚  - å†…å®¹éªŒè¯                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SQLConfig å±‚ï¼ˆSQL é…ç½®å±‚ï¼‰       â”‚
â”‚  - AbstractSQLConfig                â”‚
â”‚  - SQL ç”Ÿæˆ                         â”‚
â”‚  - æ•°æ®åº“é€‚é…                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SQLExecutor å±‚ï¼ˆSQL æ‰§è¡Œå±‚ï¼‰       â”‚
â”‚  - AbstractSQLExecutor              â”‚
â”‚  - SQL æ‰§è¡Œ                         â”‚
â”‚  - ç»“æœå¤„ç†                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®åº“                          â”‚
â”‚  MySQL / PostgreSQL / SQLite / ...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–‡ä»¶ç»“æ„

```
nestjs-apijson/src/core/
â”œâ”€â”€ parsers/
â”‚   â”œâ”€â”€ column-parser.ts          âœ… åˆ—é€‰æ‹©è§£æå™¨
â”‚   â”œâ”€â”€ order-parser.ts           âœ… æ’åºè§£æå™¨
â”‚   â”œâ”€â”€ group-parser.ts           âœ… åˆ†ç»„è§£æå™¨
â”‚   â”œâ”€â”€ having-parser.ts          âœ… åˆ†ç»„è¿‡æ»¤è§£æå™¨
â”‚   â”œâ”€â”€ combine-parser.ts         âœ… ç»„åˆæ¡ä»¶è§£æå™¨
â”‚   â”œâ”€â”€ pagination-parser.ts      âœ… åˆ†é¡µè§£æå™¨
â”‚   â”œâ”€â”€ cache-parser.ts           âœ… ç¼“å­˜è§£æå™¨
â”‚   â”œâ”€â”€ explain-parser.ts         âœ… è§£é‡Šè®¡åˆ’è§£æå™¨
â”‚   â”œâ”€â”€ join-parser.ts           âœ… JOINè§£æå™¨
â”‚   â”œâ”€â”€ subquery-parser.ts        âœ… å­æŸ¥è¯¢è§£æå™¨
â”‚   â”œâ”€â”€ reference-parser.ts       âœ… å¼•ç”¨è§£æå™¨
â”‚   â”œâ”€â”€ array-parser.ts          âœ… æ•°ç»„è§£æå™¨
â”‚   â””â”€â”€ aggregate-parser.ts      âœ… èšåˆå‡½æ•°è§£æå™¨
â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ memory-cache.ts          ğŸ“‹ å†…å­˜ç¼“å­˜å®ç°
â”‚   â””â”€â”€ redis-cache.ts           ğŸ“‹ Redisç¼“å­˜å®ç°
â”œâ”€â”€ transaction/
â”‚   â””â”€â”€ transaction-manager.ts   ğŸ“‹ äº‹åŠ¡ç®¡ç†å™¨
â”œâ”€â”€ batch/
â”‚   â””â”€â”€ batch-processor.ts       ğŸ“‹ æ‰¹é‡æ“ä½œå¤„ç†å™¨
â”œâ”€â”€ verifier/
â”‚   â”œâ”€â”€ access-verifier.ts       ğŸ“‹ è®¿é—®éªŒè¯å™¨
â”‚   â””â”€â”€ role-verifier.ts         ğŸ“‹ è§’è‰²éªŒè¯å™¨
â”œâ”€â”€ abstract-parser.ts           âœ… è§£æå™¨æŠ½è±¡ç±»
â”œâ”€â”€ abstract-object-parser.ts    âœ… å¯¹è±¡è§£æå™¨æŠ½è±¡ç±»
â”œâ”€â”€ abstract-sql-config.ts      âœ… SQLé…ç½®æŠ½è±¡ç±»
â”œâ”€â”€ abstract-sql-executor.ts    âœ… SQLæ‰§è¡Œå™¨æŠ½è±¡ç±»
â”œâ”€â”€ abstract-verifier.ts        âœ… éªŒè¯å™¨æŠ½è±¡ç±»
â”œâ”€â”€ abstract-function-parser.ts  âœ… å‡½æ•°è§£æå™¨æŠ½è±¡ç±»
â”œâ”€â”€ join.model.ts              âœ… JOINæ¨¡å‹
â”œâ”€â”€ subquery.model.ts          âœ… å­æŸ¥è¯¢æ¨¡å‹
â”œâ”€â”€ operator-parser.ts         âœ… è¿ç®—ç¬¦è§£æå™¨
â””â”€â”€ apijson-config.ts          âœ… é…ç½®ç®¡ç†
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬æŸ¥è¯¢
```json
{
  "Moment": {
    "id": 12
  }
}
```

### 2. å­—æ®µé€‰æ‹©å’Œæ’åº
```json
{
  "[]": {
    "Moment": {
      "@column": "id,date,content",
      "@order": "date-,id"
    }
  }
}
```

### 3. åˆ†ç»„æŸ¥è¯¢
```json
{
  "[]": {
    "Moment": {
      "@column": "userId;count(id):count",
      "@group": "userId"
    }
  }
}
```

### 4. JOINæŸ¥è¯¢
```json
{
  "[]": {
    "join": "&/User/id@,</Comment/momentId@",
    "Moment": {},
    "User": {
      "id@": "/Moment/userId"
    }
  }
}
```

### 5. å­æŸ¥è¯¢
```json
{
  "User": {
    "id@": {
      "from": "Comment",
      "Comment": {
        "@column": "min(userId)"
      }
    }
  }
}
```

### 6. å¼•ç”¨èµ‹å€¼
```json
{
  "Moment": {
    "userId": 38710
  },
  "User": {
    "id@": "/Moment/userId"
  }
}
```

### 7. æ•°ç»„æŸ¥è¯¢
```json
{
  "User[]": {
    "count": 3,
    "User": {}
  }
}
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å®ç°ç¼“å­˜æœºåˆ¶**
   - å†…å­˜ç¼“å­˜å®ç°
   - Redis ç¼“å­˜å®ç°

2. **å®ç°äº‹åŠ¡ç®¡ç†**
   - äº‹åŠ¡æ§åˆ¶
   - ä¿å­˜ç‚¹ç®¡ç†

3. **å®ç°æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡æ’å…¥
   - æ‰¹é‡æ›´æ–°
   - æ‰¹é‡åˆ é™¤

4. **å®Œå–„æƒé™æ§åˆ¶**
   - è§’è‰²éªŒè¯å®ç°
   - è®¿é—®æ§åˆ¶å®ç°

5. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•

6. **æ›´æ–°æ–‡æ¡£**
   - API æ–‡æ¡£
   - ä½¿ç”¨æŒ‡å—
   - æœ€ä½³å®è·µ

## æ€»ç»“

æœ¬æ–‡æ¡£æ€»ç»“äº† APIJSON ORM æ ¸å¿ƒåŠŸèƒ½çš„å®ç°æƒ…å†µã€‚å·²å®Œæˆçš„åŠŸèƒ½åŒ…æ‹¬ï¼š

1. âœ… ç‰¹æ®Šå­—æ®µè§£æå™¨ï¼ˆ@column, @order, @group, @having, @combineï¼‰
2. âœ… æ•°ç»„å…³é”®è¯è§£æå™¨ï¼ˆcount, page, queryï¼‰
3. âœ… JOINæŸ¥è¯¢æ”¯æŒï¼ˆ10ç§JOINç±»å‹ï¼‰
4. âœ… å­æŸ¥è¯¢åŠŸèƒ½ï¼ˆWHERE, FROM, SELECT, EXISTS, ALL/ANYï¼‰
5. âœ… å¼•ç”¨èµ‹å€¼åŠŸèƒ½ï¼ˆkey@, key{}@ï¼‰
6. âœ… æ•°ç»„æŸ¥è¯¢åŠŸèƒ½ï¼ˆTable[], []ï¼‰
7. âœ… èšåˆå‡½æ•°æ”¯æŒï¼ˆCOUNT, SUM, AVG, MIN, MAXï¼‰

å¾…å®ç°çš„åŠŸèƒ½åŒ…æ‹¬ï¼š

1. ğŸ“‹ ç¼“å­˜æœºåˆ¶ï¼ˆå†…å­˜ç¼“å­˜ã€Redisç¼“å­˜ï¼‰
2. ğŸ“‹ äº‹åŠ¡ç®¡ç†ï¼ˆäº‹åŠ¡æ§åˆ¶ã€ä¿å­˜ç‚¹ç®¡ç†ï¼‰
3. ğŸ“‹ æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰
4. ğŸ“‹ æƒé™æ§åˆ¶ï¼ˆè§’è‰²éªŒè¯ã€è®¿é—®æ§åˆ¶ï¼‰

æ‰€æœ‰å·²å®ç°çš„åŠŸèƒ½éƒ½éµå¾ª APIJSON è¯­æ³•æ ‡å‡†ï¼Œå…·æœ‰è‰¯å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚é€šè¿‡ç³»ç»Ÿçš„å®ç°å’Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°†æä¾›ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜å¼‚ã€æ˜“äºä½¿ç”¨çš„ APIJSON ORM å®ç°ã€‚
